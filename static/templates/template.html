<!DOCTYPE html>

<html>

<head>
    <!-- Three mandatory meta tags when using Bootstrap -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/css/main.css">
    <title>Dataset comparison report</title>
</head>

<body>

<div class="container" style="max-width: 1000px;">

    <!-- Title across the entire container -->
    <div style="text-align: center;">
        <h1>Visual report comparing two datasets</h1>
        <p><i>Built using Seaborn, Bootstrap and Jinja2 templates</i></p>
    </div>

    <!-- Summary text -->
    <div>
        <h4>What can we tell you about these two datasets?</h4>
    </div>

    <!-- Summary tables with number of rows and columns in each dataset -->
    <div class="d-flex">
        <div class="row">
            {% for df in summary['DFs'] %}
            <div class="col-md-6">
            <table>
                <TR>
                    <TD class="table_top" colspan="2">{{ df }}</TD>
                </TR>
                <TR>
                    <TD class="table_top file_name" colspan="2">{{ summary['DFs'][df]['file_name'] }}</TD>
                </TR>
                <TR>
                    <TD>Number of rows</TD>
                    <TD>Number of columns</TD>
                </TR>
                <TR>
                    <TD>{{ summary['DFs'][df]['shape'][0] }}</TD>
                    <TD>{{ summary['DFs'][df]['shape'][1] }}</TD>
                </TR>
            </table>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Mismatching columns -->
    <div>
        <h5 class="py-2 col-md-9" style="text-align: center"><u>Mismatching</u> variable names:</h5>
        <ul>
            {% for item in summary['Metadata']['diff_vars'] %}

                <li style="font-size: 18px">

                {% if item|length == 2 %}
                    {{ item[0] }} - only in {{ item[1] }}
                {% else %}
                    {{ item }}
                {% endif %}
                
                </li>

            {% endfor %}
        </ul>
    </div>

    <!-- Detailed tables generator -->
    <div>
    <!-- Create a table for each var_type: Categorical, Continuous, Timeseries -->
    {% for var_type in summary['Metadata']['common_vars'].keys() %}

    <h5 class="col-md-9" style="text-align: center">{{var_type}} variables</h5>

    <div class="row">
            <div class="col-md-9">
            <table class="table table-hover">
                <thead>
                    <TR>
                        <TD class="table_top">Variable Name</TD>
                        <!-- Since columns might differ depending on var_type, they are generated in their own loop -->
                        {% for col_name in summary['Metadata']['table_columns'][var_type] %}
                        <TD class="table_top">DF1 - {{ col_name }}</TD>
                        <TD class="table_top">DF2 - {{ col_name }}</TD>
                        {% endfor %}

                    </TR>
                </thead>
                <tbody>
                    <!-- Each row in the table corresponds to a variable in the dataset; rows are also generated in a loop -->
                    {% for var_name in summary['Metadata']['common_vars'][var_type].keys() %}
                        <!-- Save the long dict path to an internal Jinja variable for clarity -->
                        {% set root_dict = summary['Metadata']['common_vars'][var_type][var_name]['DFs'] %}
        
                        <TR>
                            <TD>{{ var_name }}</TD>
                            <!-- Since we don't know how many columns each var_type has, we need another loop -->
                            {% for col_name in summary['Metadata']['table_columns'][var_type] %}
        
                            <TD class={{ 'diff_highlight' if root_dict['DF1'][col_name] != root_dict['DF2'][col_name] }}>
                                {{ root_dict['DF1'][col_name] }}
                            </TD>
                            <TD class={{ 'diff_highlight' if root_dict['DF1'][col_name] != root_dict['DF2'][col_name] }}>
                                {{ root_dict['DF2'][col_name] }}
                            </TD>

                            {% endfor %}
                        </TR>
        
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% endfor %}

    </div>

    <!-- Plot headline text -->
    <div>
        <h4>Okay, but how do they actually look like. In person, you know?</h4>
        <p><i>Cross-hatching indicates differences between two datasets</i></p>
    </div>

    <!-- Plots -->
    <div class="row">
        <div class= "d-flex align-content-start">
        <div class="col-md-6" style="text-align: center;">
            <p>Here's the first dataset</p>
            <img src="static/images/image_1.png" class="img-fluid"/></div>
        <div class="col-md-6" style="text-align: center;">
            <p>Here's the second dataset</p>
            <img src="static/images/image_2.png" class="img-fluid"/></div>
        </div>
    </div>

</div>

</body>
</html>